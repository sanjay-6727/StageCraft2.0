<!doctype html>
<html lang="en" data-bs-theme="light">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="SDLC Development Board - Modern Enterprise Workflow">

  <title>SDLC Development Board</title>

  <!-- Bootstrap 5.3 CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">

  <!-- Google Fonts: Manrope -->
  <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@300;400;500;600;700;800&display=swap"
    rel="stylesheet">

  <!-- Material Symbols -->
  <link href="https://fonts.googleapis.com/icon?family=Material+Symbols+Outlined" rel="stylesheet">

  <!-- Tailwind via CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          fontFamily: {
            sans: ['Manrope', 'system-ui', 'sans-serif'],
          },
          colors: {
            primary: { DEFAULT: '#0d6efd', 50: '#eff6ff', 100: '#dbeafe' }
          },
          borderRadius: { '4xl': '2rem' }
        }
      }
    }
  </script>

  <style>
    :root {
      --glass-bg: rgba(255, 255, 255, 0.72);
      --glass-border: rgba(255, 255, 255, 0.30);
      --glass-shadow: 0 10px 40px rgba(31, 38, 135, 0.12);
    }

    [data-bs-theme="dark"] {
      --glass-bg: rgba(30, 41, 59, 0.64);
      --glass-border: rgba(255, 255, 255, 0.10);
      --glass-shadow: 0 10px 40px rgba(0, 0, 0, 0.45);
    }

    body {
      font-family: 'Manrope', system-ui, sans-serif;
      background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
      min-height: 100vh;
    }

    [data-bs-theme="dark"] body {
      background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
    }

    .glass {
      background: var(--glass-bg);
      backdrop-filter: blur(16px);
      -webkit-backdrop-filter: blur(16px);
      border: 1px solid var(--glass-border);
      box-shadow: var(--glass-shadow);
      border-radius: 1.5rem;
    }

    .sidebar {
      transition: transform 0.35s cubic-bezier(0.4, 0, 0.2, 1);
      z-index: 1030;
    }

    .custom-scrollbar::-webkit-scrollbar {
      width: 6px;
      height: 6px;
    }

    .custom-scrollbar::-webkit-scrollbar-track {
      background: transparent;
    }

    .custom-scrollbar::-webkit-scrollbar-thumb {
      background: #94a3b8;
      border-radius: 3px;
    }

    [data-bs-theme="dark"] .custom-scrollbar::-webkit-scrollbar-thumb {
      background: #475569;
    }

    button:focus-visible,
    a:focus-visible,
    input:focus-visible {
      outline: 2px solid #0d6efd;
      outline-offset: 2px;
    }
  </style>
</head>

<body class="d-flex flex-column min-vh-100">

  <!-- Sidebar -->
  <aside
    class="sidebar bg-white dark:bg-slate-900 border-end border-slate-200 dark:border-slate-800 position-fixed top-0 start-0 h-100 glass overflow-hidden"
    id="sidebar" style="width: 280px; transform: translateX(0);">
    <div class="d-flex flex-column h-100">

      <!-- Brand -->
      <div class="p-4 border-bottom border-slate-200 dark:border-slate-800 d-flex align-items-center gap-3">
        <div class="bg-primary text-white rounded d-flex align-items-center justify-content-center fs-4"
          style="width:48px; height:48px;">
          <span class="material-symbols-outlined">developer_board</span>
        </div>
        <div>
          <h4 class="fw-bold mb-0">StageCraft</h4>
          <small class="text-muted">Workflow Engine</small>
        </div>
      </div>

      <!-- Navigation -->
      <nav class="flex-grow-1 p-3 overflow-y-auto custom-scrollbar">
        <ul class="nav flex-column gap-1">
          <li><a href="/ui/projects"
              class="nav-link d-flex align-items-center gap-3 px-3 py-2 fw-medium text-dark hover-bg-primary-subtle"><span
                class="material-symbols-outlined">folder_open</span> Projects</a></li>
          <li><a href="/ui/board" class="nav-link d-flex align-items-center gap-3 px-3 py-2 active fw-medium"><span
                class="material-symbols-outlined">dashboard</span> Board</a></li>
          <li><a href="/ui/metrics" class="nav-link d-flex align-items-center gap-3 px-3 py-2"><span
                class="material-symbols-outlined">analytics</span> Insights</a></li>
          <li><a href="/ui/compliance" class="nav-link d-flex align-items-center gap-3 px-3 py-2"><span
                class="material-symbols-outlined">verified_user</span> Audit Report</a></li>
          <li><a href="#" class="nav-link d-flex align-items-center gap-3 px-3 py-2"><span
                class="material-symbols-outlined">list_alt</span> Backlog</a></li>
          <li><a href="#" class="nav-link d-flex align-items-center gap-3 px-3 py-2"><span
                class="material-symbols-outlined">settings</span> Settings</a></li>
        </ul>

        <hr class="my-4 border-slate-200 dark:border-slate-700">

        <small class="px-3 text-uppercase fw-bold text-muted d-block mb-2">Active Projects</small>
        <ul class="nav flex-column gap-1">
          <li><a href="#" class="nav-link d-flex justify-content-between px-3 py-2"><span>Cloud Infra</span><span
                class="badge bg-primary-subtle text-primary">12</span></a></li>
          <li><a href="#" class="nav-link d-flex justify-content-between px-3 py-2"><span>Mobile SDK</span><span
                class="badge bg-primary-subtle text-primary">8</span></a></li>
        </ul>
      </nav>

      <!-- User -->
      <div class="p-4 border-top border-slate-200 dark:border-slate-800">
        <div class="d-flex align-items-center gap-3">
          <img src="https://ui-avatars.com/api/?name={{ session.get('username', 'Guest') }}&background=0d6efd&color=fff"
            alt="User" class="rounded-circle" width="48" height="48">
          <div class="flex-grow-1 min-w-0">
            <div class="fw-medium text-dark">{{ session.get('username', 'Guest') }}</div>
            <small class="text-muted d-block text-truncate">Active User</small>
          </div>
          {% if session.get('user_id') %}
          <a href="/ui/logout" class="btn btn-sm btn-icon text-danger" title="Logout"><span
              class="material-symbols-outlined">logout</span></a>
          {% else %}
          <a href="/ui/login" class="btn btn-sm btn-icon text-primary" title="Login"><span
              class="material-symbols-outlined">login</span></a>
          {% endif %}
        </div>
      </div>
    </div>
  </aside>

  <!-- Main wrapper -->
  <div class="flex-grow-1" id="main-wrapper"
    style="margin-left: 280px; transition: margin-left 0.35s cubic-bezier(0.4, 0, 0.2, 1);">

    <!-- Header -->
    <header class="navbar navbar-expand-lg glass border-bottom sticky-top z-2">
      <div class="container-fluid px-4">

        <!-- Mobile toggle -->
        <button class="btn btn-icon d-lg-none me-2" id="mobileSidebarToggle">
          <span class="material-symbols-outlined fs-2">menu</span>
        </button>

        <!-- Desktop toggle -->
        <button class="btn btn-icon d-none d-lg-inline-flex me-2" id="desktopSidebarToggle">
          <span class="material-symbols-outlined fs-2">menu_open</span>
        </button>

        <!-- Brand (mobile only) -->
        <a class="navbar-brand fw-bold d-lg-none" href="#">SDLC Board</a>

        <!-- Right side controls -->
        <div class="ms-auto d-flex align-items-center gap-3">

          <!-- Search -->
          <div class="d-none d-md-block" style="width: 320px;">
            <div class="input-group">
              <span class="input-group-text bg-transparent border-end-0"><span
                  class="material-symbols-outlined">search</span></span>
              <input type="search" class="form-control border-start-0 rounded-pill rounded-start-0"
                placeholder="Search items, IDs...">
            </div>
          </div>

          <!-- Theme buttons -->
          <div class="d-flex gap-1">
            <button id="btnLight"
              class="btn btn-sm btn-outline-secondary theme-btn active d-flex align-items-center gap-1">
              <span class="material-symbols-outlined">light_mode</span>
            </button>
            <button id="btnDark" class="btn btn-sm btn-outline-secondary theme-btn d-flex align-items-center gap-1">
              <span class="material-symbols-outlined">dark_mode</span>
            </button>
          </div>

          <!-- New Item -->
          <button class="btn btn-primary rounded-pill d-flex align-items-center gap-2 shadow" data-bs-toggle="modal"
            data-bs-target="#createModal">
            <span class="material-symbols-outlined">add</span> New Item
          </button>

          <!-- Notifications -->
          <button class="btn btn-icon position-relative">
            <span class="material-symbols-outlined">notifications</span>
            <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger">3</span>
          </button>
        </div>
      </div>
    </header>

    <!-- Page Content -->
    <main class="flex-grow-1 py-4 px-3 px-lg-4">
      {% block content %}{% endblock %}
    </main>

  </div>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
    crossorigin="anonymous"></script>

  <!-- Sidebar logic -->
  <script>
    const sidebar = document.getElementById('sidebar');
    const mainWrapper = document.getElementById('main-wrapper');
    const mobileToggle = document.getElementById('mobileSidebarToggle');
    const desktopToggle = document.getElementById('desktopSidebarToggle');

    const SIDEBAR_WIDTH = 280;

    function isDesktop() {
      return window.innerWidth >= 992;
    }

    function collapseSidebar() {
      sidebar.style.transform = 'translateX(-100%)';
      mainWrapper.style.marginLeft = '0';
      localStorage.setItem('sidebarCollapsed', 'true');

      const icon = 'menu';
      if (mobileToggle) mobileToggle.querySelector('span').textContent = icon;
      if (desktopToggle) desktopToggle.querySelector('span').textContent = icon;
    }

    function expandSidebar() {
      sidebar.style.transform = 'translateX(0)';
      mainWrapper.style.marginLeft = isDesktop() ? `${SIDEBAR_WIDTH}px` : '0';
      localStorage.setItem('sidebarCollapsed', 'false');

      const icon = 'menu_open';
      if (mobileToggle) mobileToggle.querySelector('span').textContent = icon;
      if (desktopToggle) desktopToggle.querySelector('span').textContent = icon;
    }

    function toggleSidebar() {
      const isCollapsed = sidebar.style.transform === 'translateX(-100%)';
      isCollapsed ? expandSidebar() : collapseSidebar();
    }

    function updateLayout() {
      const collapsed = localStorage.getItem('sidebarCollapsed') === 'true';

      if (isDesktop()) {
        collapsed ? collapseSidebar() : expandSidebar();
      } else {
        collapseSidebar(); // Mobile always starts collapsed
      }
    }

    window.addEventListener('load', updateLayout);
    window.addEventListener('resize', updateLayout);

    mobileToggle?.addEventListener('click', toggleSidebar);
    desktopToggle?.addEventListener('click', toggleSidebar);

    document.addEventListener('click', e => {
      if (isDesktop()) return;

      const clickedInside = sidebar.contains(e.target);
      const clickedToggle =
        mobileToggle?.contains(e.target) ||
        desktopToggle?.contains(e.target);

      if (!clickedInside && !clickedToggle) {
        collapseSidebar();
      }
    });

    document.addEventListener('keydown', e => {
      if (e.key === 'Escape') {
        collapseSidebar();
      }
    });
  </script>

  <!-- Fixed & robust theme switching -->
  <script>
    function setTheme(theme) {
      document.documentElement.setAttribute('data-bs-theme', theme);
      localStorage.setItem('theme', theme);

      const btnLight = document.getElementById('btnLight');
      const btnDark = document.getElementById('btnDark');

      if (btnLight) {
        btnLight.classList.toggle('active', theme === 'light');
      }
      if (btnDark) {
        btnDark.classList.toggle('active', theme === 'dark');
      }
    }

    document.addEventListener('DOMContentLoaded', () => {
      const saved = localStorage.getItem('theme');
      const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
      const initial = saved || (prefersDark ? 'dark' : 'light');

      setTheme(initial);

      const btnLight = document.getElementById('btnLight');
      const btnDark = document.getElementById('btnDark');

      if (btnLight) {
        btnLight.addEventListener('click', () => setTheme('light'));
      }
      if (btnDark) {
        btnDark.addEventListener('click', () => setTheme('dark'));
      }

      // Optional: follow system changes if no manual preference
      window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', e => {
        if (!localStorage.getItem('theme')) {
          setTheme(e.matches ? 'dark' : 'light');
        }
      });
    });
  </script>

</body>

</html>